#!/usr/bin/env bash
set -Eeuo pipefail

ROOT="$(git rev-parse --show-toplevel 2>/dev/null || pwd)"
REX_HOME="${REX_HOME:-$ROOT/.rex_agent}"
REX_SRC="${REX_SRC:-$REX_HOME/src}"
PYTHON_BIN="${PYTHON:-python3}"

if ! command -v "$PYTHON_BIN" >/dev/null 2>&1; then
  echo "[rex-codex] python3 is required to launch the CLI" >&2
  exit 127
fi

export ROOT REX_HOME REX_SRC
if [[ -d "$REX_SRC/src" ]]; then
  PYTHON_ROOT="$REX_SRC/src"
else
  PYTHON_ROOT="$REX_SRC"
fi
export PYTHONPATH="$PYTHON_ROOT${PYTHONPATH:+:$PYTHONPATH}"

exec "$PYTHON_BIN" -m rex_codex "$@"
